<!DOCTYPE html>
<html lang="zh-CN"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="fragments/webNewModel">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title th:text="${session.company ne null?session.company.name:'收银台'}">收银台</title>
    <link type="text/css" rel="stylesheet" href="/web/newOrders/orders-index.css"/>
    <link type="text/css" rel="stylesheet" href="/web/newOrders/orders-pay.css"/>
    <script type="text/javascript" src="/web/newOrders/orders-index.js"></script>
    <script type="text/javascript" src="/web/newOrders/orders-pay-list.js"></script>
    <script type="text/javascript" src="/web/newOrders/orders-show-btn.js"></script>
    <link type="text/css" rel="stylesheet" href="/web/web-orders-show.css"/>
    <script src="/web/web-show-time.js"></script>
    <script type="text/javascript">
        $(function() {
            buildCom();
        });
    </script>
</head>
<body>
    <div th:fragment="content" th:remove="tag">
        <div class="orders-main-div ">
            <div class="row">
                <div class="col-md-3 col-sm-3 col-xs-3 col-lg-3">
                    <div class="max-height pay-commodity-list">
                        <h4 class="title">订单信息</h4>
                        <div class="order-info">
                            <p>订单编号：<span th:text="${order.no}"></span></p>
                            <p>订单金额：<span th:text="${order.totalMoney}"></span> 元</p>
                            <p>商品数量：<span th:text="${order.commodityCount}"></span></p>
                            <p>创建时间：<span th:text="${order.createTime}"></span></p>
                        </div>
                        <table class="commodity-table">
                            <tr>
                                <th>商品</th>
                                <th>数量</th>
                                <th>小计</th>
                            </tr>
                        </table>
                        <div class="commodity-list-hidden" style="display:none">
                            <span th:each="commodity : ${commodityList}" th:attr="comName=${commodity.commodityName}, comNo=${commodity.commodityNo}, price=${commodity.price}"></span>
                        </div>
                    </div>
                </div>
                <div class="col-md-9 col-sm-9 col-xs-9 col-lg-9">
                    <div class="max-height" style="padding:15px;">
                        <table class="show-detail">
                            <tr>
                                <td class="field">订单类型：</td>
                                <td>
                                    <span th:switch="${order.type}" th:remove="tag">
                                        <span th:case="1">店内订单</span>
                                        <span th:case="2">美团订单</span>
                                        <span th:case="3">微信订单</span>
                                        <span th:case="4">友情价订单</span>
                                        <span th:case="5">会员订单（已扣：<span th:text="${order.discountMoney}+ ' 元'" style="color:#F60;"></span>）</span>
                                        <span th:case="6">卡券订单</span>
                                    </span>
                                </td>
                                <td class="field">订单编号：</td>
                                <td th:text="${order.no}"></td>
                            </tr>

                            <tr>
                                <td class="field">收银员姓名：</td>
                                <td th:text="${order.cashierName}"></td>
                                <td class="field">收银员电话：</td>
                                <td th:text="${order.cashierPhone}"></td>
                            </tr>

                            <tr>
                                <td class="field">就餐费用：</td>
                                <td th:if="${order.totalMoney ne null}">
                                    <span style="color:#F00;" class="discount-money totalMoney" th:text="${#numbers.formatDecimal(order.totalMoney, 0, 'COMMA', 1, 'POINT')}"></span> 元
                                </td>
                                <td class="field">剩余压金：</td>
                                <td th:text="${order.surplusBond}+' 元（只收全票人员）'" class="surplusBond"></td>
                            </tr>

                            <tr>
                                <td class="field">付款方式：</td>
                                <td>
                                    <span th:switch="${order.payType}" th:remove="tag">
                                        <span th:case="1">现金支付</span>
                                        <span th:case="2">刷卡支付</span>
                                        <span th:case="3">微信支付</span>
                                        <span th:case="4">支付宝支付</span>
                                        <span th:case="*">未知</span>
                                    </span>
                                </td>
                                <td class="field">订单状态：</td>
                                <td>
                                    <span th:switch="${order.status}" th:remove="tag">
                                        <span th:case="0">已下单</span>
                                        <span th:case="1">已付款</span>
                                        <span th:case="2" style="color:#00F;">就餐中…</span>
                                        <span th:case="3">美团已确认</span>
                                        <span th:case="4" style="color:#00F">压金已全退（订单完成）</span>
                                        <span th:case="5" style="color:#F60">已退部份压金（扣<b th:text="${order.surplusBond}+' 元'"></b>）</span>
                                        <span th:case="6" style="color:#F60">折扣已确认（请收款）</span>
                                        <span th:case="-1" style="color:#F00;">已退票（<b th:remove="tag" th:text="${order.retreatReason}"></b>）</span>
                                        <span th:case="-2" style="color:#F00;">已取消（<b th:remove="tag" th:text="${order.retreatReason}"></b>）</span>
                                        <span th:case="-3" style="color:#F00;">被驳回，不可给予折扣</span>
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td class="field">订单时间：</td>
                                <td th:text="${order.createTime}"></td>
                                <td class="field">入场时间：</td>
                                <td>
                                    <span th:text="${order.entryTime}"></span>
                                    <span th:if="${order.status eq '2'}">（用时：<span th:text="${order.entryLong}" class="show-seconds-now"></span>）</span>
                                </td>
                            </tr>
                            <tr th:if="${order.endTime ne null and order.entryTime ne null}">
                                <td class="field">离场时间：</td>
                                <td th:text="${order.endTime}"></td>
                                <td class="field">就餐用时：</td>
                                <td th:text="${order.endLong-order.entryLong}" class="show-seconds"></td>
                            </tr>
                        </table>
                        <div style="width:100%; padding-top:15px; padding-left:10px;" th:if="${order.status eq '0' or order.status eq '1' or order.status eq '2' or order.status eq '3'}">
                            <button th:if="${order.status eq '2'}" th:onclick="'window.location.href=\'/web/newOrders/returnBond?no='+${order.no}+'\''" class="btn btn-info"><i class="fa fa-flask"></i> 退压金</button>
                            <button onclick="onRetreatBtnClick()" class="btn  btn-danger retreat-btn"><i class="fa fa-times-circle"></i> 全额退票</button>
                            <button onclick="onCancelBtnClick()" th:if="${order.type eq '4'}" class="btn btn-danger"><i class="fa fa-window-close"></i> 取消订单</button>
                            <input id="ordersNo" th:value="${order.no}" type="hidden"/>
                            <input id="ordersStatus" th:value="${order.status}" type="hidden"/>
                            <input id="refundMin" th:value="${rules.refundMin}" type="hidden"/>
                            <input id="entryLong" th:value="${order.entryLong}" type="hidden"/>
                            <input id="ordersType" th:value="${order.type}" type="hidden"/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>